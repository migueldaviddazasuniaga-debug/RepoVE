<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparadora de Precios Vzla</title>
    <style>
        :root {
            --bg-dark: #0a0a0a;
            --card-bg: #141414;
            --text-main: #ffffff;
            --text-dim: #888;
            --vinotinto: #820000;
            --accent-green: #2ecc71;
            --accent-yellow: #f1c40f;
            --accent-red: #e74c3c;
            --input-bg: #222;
        }

        body {
            background-color: var(--bg-dark);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            -webkit-font-smoothing: antialiased; /* Mejora nitidez */
        }

        /* --- 3D ENGINE --- */
        .scene {
            width: 360px;
            height: 700px;
            perspective: 1200px;
            position: relative;
        }

        .carousel {
            width: 100%;
            height: 100%;
            position: absolute;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .face {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 24px;
            background: var(--card-bg);
            border: 1px solid #333;
            overflow: hidden;
            backface-visibility: hidden; /* Clave para evitar blurry */
            display: flex;
            flex-direction: column;
            /* La opacidad del texto mejora al no tener sombras complejas */
        }

        /* Posiciones del Prisma (Tri√°ngulo) */
        .face-1 { transform: rotateY(0deg) translateZ(105px); z-index: 3; }
        .face-2 { transform: rotateY(120deg) translateZ(105px); z-index: 2; }
        .face-3 { transform: rotateY(240deg) translateZ(105px); z-index: 1; }

        /* --- COMPONENTES COMUNES --- */
        .header {
            padding: 15px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(to bottom, #1a1a1a, #141414);
        }
        .header h2 { margin: 0; font-size: 16px; color: var(--vinotinto); letter-spacing: 0.5px; text-transform: uppercase; font-weight: 800; }
        
        .content { padding: 15px; flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }

        /* --- INPUTS Y GRID --- */
        .row-label { font-size: 11px; color: var(--text-dim); margin-bottom: 4px; display: block; }
        
        .dual-grid { display: flex; gap: 10px; }
        .input-wrapper { flex: 1; display: flex; flex-direction: column; }
        
        .input-box {
            display: flex;
            background: var(--input-bg);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 2px;
            align-items: center;
        }
        
        .input-box input {
            background: transparent;
            border: none;
            color: white;
            padding: 8px;
            width: 100%;
            font-size: 16px;
            font-family: monospace;
            text-align: right;
            outline: none;
        }

        .currency-select {
            background: #333;
            color: white;
            border: none;
            font-size: 12px;
            padding: 5px;
            border-radius: 4px;
            margin-right: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        /* --- TEXTOS CHIQUITOS (CONVERSIONES) --- */
        .micro-text {
            font-size: 9px;
            color: #666;
            margin-top: 4px;
            line-height: 1.3;
            font-family: monospace;
        }
        .micro-val { color: #aaa; }

        /* --- RESULTADOS --- */
        .result-panel {
            background: #1a1a1a;
            border-radius: 10px;
            padding: 12px;
            border: 1px solid #333;
            margin-top: 10px;
        }
        
        .tasa-implicita-display {
            text-align: center;
            font-size: 28px;
            font-weight: 800;
            margin: 10px 0;
            font-family: monospace;
        }

        .status-badge {
            text-align: center;
            font-size: 12px;
            font-weight: bold;
            padding: 4px;
            border-radius: 4px;
            margin-top: 5px;
            text-transform: uppercase;
        }

        /* Colores de estado */
        .status-green { color: var(--accent-green); border: 1px solid var(--accent-green); background: rgba(46, 204, 113, 0.1); }
        .status-yellow { color: var(--accent-yellow); border: 1px solid var(--accent-yellow); background: rgba(241, 196, 15, 0.1); }
        .status-red { color: var(--accent-red); border: 1px solid var(--accent-red); background: rgba(231, 76, 60, 0.1); }

        /* --- BOTONES --- */
        .nav-btn {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            z-index: 100;
            display: flex; justify-content: center; align-items: center;
            backdrop-filter: blur(5px);
        }

        .action-btn {
            background: var(--vinotinto);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        .btn-refresh {
            background: transparent; border: none; color: var(--accent-green); cursor: pointer; font-size: 18px;
        }

        /* --- LOG --- */
        .log-list { font-size: 10px; font-family: monospace; color: #ccc; }
        .log-item { padding: 8px 0; border-bottom: 1px solid #333; }
        .log-highlight { color: var(--accent-yellow); }

    </style>
</head>
<body>

<div class="scene">
    <div class="carousel" id="carousel">
        
        <div class="face face-1">
            <div class="header">
                <h2>Comparadora Vzla</h2>
                <button class="btn-refresh" onclick="buscarTasasAPI()" id="refreshBtn">‚ü≥</button>
            </div>
            <div class="content">
                
                <div class="dual-grid">
                    <div class="input-wrapper">
                        <span class="row-label">Tasa BCV (Oficial)</span>
                        <div class="input-box">
                            <input type="number" id="tasaBCV" placeholder="0.00" oninput="recalcularTodo()">
                        </div>
                    </div>
                    <div class="input-wrapper">
                        <span class="row-label">Tasa Paralela</span>
                        <div class="input-box">
                            <input type="number" id="tasaPar" placeholder="0.00" oninput="recalcularTodo()">
                        </div>
                    </div>
                </div>

                <hr style="border: 0; border-top: 1px solid #333; margin: 5px 0; width: 100%;">

                <div class="dual-grid">
                    
                    <div class="input-wrapper">
                        <span class="row-label">Precio Marcado ($)</span>
                        <div class="input-box">
                            <input type="number" id="precioBase" placeholder="10" oninput="recalcularTodo()">
                        </div>
                        <div class="micro-text" id="infoBase">
                            Ingresa precio...
                        </div>
                    </div>

                    <div class="input-wrapper">
                        <span class="row-label">Me piden...</span>
                        <div class="input-box">
                            <select class="currency-select" id="monedaPago" onchange="recalcularTodo()">
                                <option value="bs">Bs</option>
                                <option value="$">$</option>
                            </select>
                            <input type="number" id="precioPiden" placeholder="500" oninput="recalcularTodo()">
                        </div>
                        <div class="micro-text" id="infoPiden">
                            Ingresa monto...
                        </div>
                    </div>

                </div>

                <div class="result-panel">
                    <span class="row-label" style="text-align: center;">TASA IMPL√çCITA QUE EST√ÅS PAGANDO</span>
                    <div class="tasa-implicita-display" id="tasaImplicita">--</div>
                    <div class="status-badge" id="statusBadge">Esperando datos</div>
                    
                    <div style="margin-top:10px; font-size:11px; color:#aaa; text-align: center;" id="analisisTexto">
                        </div>
                </div>

                <button class="action-btn" onclick="guardarSnapshot()">üì∏ Guardar en Log</button>

            </div>
        </div>


        <div class="face face-2">
            <div class="header">
                <h2>Historial</h2>
                <button class="btn-refresh" onclick="borrarLog()">üóëÔ∏è</button>
            </div>
            <div class="content">
                <div class="log-list" id="logContainer">
                    <div style="text-align:center; padding:20px; color:#555">No hay registros a√∫n</div>
                </div>
            </div>
        </div>


        <div class="face face-3">
             <div style="display:flex; height:100%; justify-content:center; align-items:center; color:#333; flex-direction: column;">
                 <h1 style="font-size: 80px; font-weight: 300; color:white;">0</h1>
                 <p>Modo Camuflaje</p>
             </div>
        </div>

    </div>
    
    <button class="nav-btn" onclick="rotar()">‚Üª</button>
</div>

<script>
    /* --- 1. CONFIGURACI√ìN Y VARIABLES --- */
    let angulo = 0;
    const carousel = document.getElementById('carousel');
    
    // Elementos DOM
    const elBCV = document.getElementById('tasaBCV');
    const elPar = document.getElementById('tasaPar');
    const elBase = document.getElementById('precioBase');
    const elPiden = document.getElementById('precioPiden');
    const elMoneda = document.getElementById('monedaPago');
    const elImplicita = document.getElementById('tasaImplicita');
    const elBadge = document.getElementById('statusBadge');
    
    // Textos Chiquiticos
    const infoBase = document.getElementById('infoBase');
    const infoPiden = document.getElementById('infoPiden');

    /* --- 2. SISTEMA DE ROTACI√ìN 3D --- */
    function rotar() {
        angulo -= 120;
        carousel.style.transform = `rotateY(${angulo}deg)`;
    }

    /* --- 3. L√ìGICA DE MULTI-API (FALLBACK SYSTEM) --- */
    // Simulaci√≥n de b√∫squeda en varias fuentes
    async function buscarTasasAPI() {
        const btn = document.getElementById('refreshBtn');
        btn.innerText = '...';
        
        // Array de "Fuentes" simuladas para la estructura. 
        // En producci√≥n real pondr√≠as URLs reales aqu√≠.
        const fuentes = [
            { nombre: "DolarApi", url: "https://ve.dolarapi.com/v1/dolares" }, // Ejemplo
            { nombre: "PyDolar", url: "https://pydolarvenezuela-api.vercel.app/api/v1/dollar?page=monitor" }
        ];

        let bcvEncontrado = 0;
        let parEncontrado = 0;

        try {
            // Intento 1: DolarApi (Suele ser estable)
            const res = await fetch('https://ve.dolarapi.com/v1/dolares');
            if(res.ok) {
                const data = await res.json();
                // Buscar BCV
                const oficial = data.find(d => d.fuente === 'oficial');
                if(oficial) bcvEncontrado = oficial.promedio;
                
                // Buscar Paralelo
                const paralelo = data.find(d => d.fuente === 'paralelo'); 
                if(paralelo) parEncontrado = paralelo.promedio;
            }
        } catch (e) {
            console.log("Fallo API 1, intentando siguiente...");
        }

        // Si fall√≥ la API, ponemos valores manuales (o intentariamos la API 2, 3...)
        // Aqu√≠ dejo valores "dummy" para que veas que funciona si no hay internet
        if(!bcvEncontrado) bcvEncontrado = 45.50; // Valor ejemplo
        if(!parEncontrado) parEncontrado = 53.20; // Valor ejemplo

        elBCV.value = bcvEncontrado.toFixed(2);
        elPar.value = parEncontrado.toFixed(2);
        
        btn.innerText = '‚ü≥';
        recalcularTodo();
    }

    /* --- 4. CORAZ√ìN DEL C√ÅLCULO (LA INGENIER√çA INVERSA) --- */
    function recalcularTodo() {
        const bcv = parseFloat(elBCV.value) || 0;
        const par = parseFloat(elPar.value) || 0;
        const baseUSD = parseFloat(elBase.value) || 0;
        const pidenVal = parseFloat(elPiden.value) || 0;
        const pidenMoneda = elMoneda.value; // 'bs' o '$'

        // 1. Actualizar textos chiquiticos lado izquierdo (Base)
        if(baseUSD > 0 && bcv > 0) {
            infoBase.innerHTML = `
                Oficial: <span class="micro-val">Bs ${(baseUSD * bcv).toFixed(2)}</span><br>
                Paralelo: <span class="micro-val">Bs ${(baseUSD * par).toFixed(2)}</span>
            `;
        } else {
            infoBase.innerHTML = "Ingresa monto...";
        }

        // 2. Actualizar textos chiquiticos lado derecho (Piden)
        let montoEnBolivaresReales = 0;

        if (pidenVal > 0) {
            if (pidenMoneda === 'bs') {
                // Caso B: Me piden 5400 Bs
                montoEnBolivaresReales = pidenVal;
                // Mostrar cu√°nto es en D√≥lares reales
                const segunBCV = (pidenVal / bcv).toFixed(2);
                const segunPar = (pidenVal / par).toFixed(2);
                infoPiden.innerHTML = `
                    Equivale a: <b>$${segunPar}</b> (Par)<br>
                    Si fuera oficial: <b>$${segunBCV}</b>
                `;
            } else {
                // Caso A o C: Me piden $15 (pero pagaderos en Bs a alguna tasa)
                // Asumimos que si te piden dolares para pagar en Bs, usan la tasa que declararon arriba (BCV usualmente dicen)
                // Pero aqu√≠ la trampa es el precio base vs el precio pedido.
                
                // Calculo Bs estimados si fuera legal
                const bsEstimados = pidenVal * bcv;
                montoEnBolivaresReales = bsEstimados; 
                
                infoPiden.innerHTML = `
                    Son: <span class="micro-val">Bs ${(pidenVal * bcv).toFixed(2)}</span> (al BCV)<br>
                    Son: <span class="micro-val">Bs ${(pidenVal * par).toFixed(2)}</span> (al Par)
                `;
            }
        } else {
            infoPiden.innerHTML = "Ingresa lo que piden...";
        }

        // 3. CALCULO DE TASA IMPL√çCITA (SEM√ÅFORO)
        if (baseUSD > 0 && pidenVal > 0 && bcv > 0) {
            let tasaCalculada = 0;

            if (pidenMoneda === 'bs') {
                // Si me piden Bs, divido entre el precio BASE en Dolares para saber a cuanto me cobran el $
                tasaCalculada = pidenVal / baseUSD;
            } else {
                // Si me piden Dolares (Ej: Base $10, Piden $15 pagando en Bs a BCV)
                // Tengo que convertir lo que piden a Bs usando la tasa oficial (que es la excusa)
                // Y dividir entre el precio base.
                const bsQueVoyAPagar = pidenVal * bcv; 
                tasaCalculada = bsQueVoyAPagar / baseUSD;
            }

            elImplicita.innerText = tasaCalculada.toFixed(2) + " Bs/$";

            // L√≥gica de Sem√°foro
            const diffBCV = Math.abs(tasaCalculada - bcv);
            const diffPar = Math.abs(tasaCalculada - par);

            elBadge.className = 'status-badge';
            const analisis = document.getElementById('analisisTexto');

            if (tasaCalculada <= (bcv * 1.01)) { // Margen de error 1%
                // VERDE: Precio justo (BCV)
                elBadge.classList.add('status-green');
                elBadge.innerText = "EXCELENTE (OFICIAL)";
                analisis.innerText = "Te est√°n cobrando a tasa BCV real.";
            } else if (tasaCalculada >= (par * 0.98)) {
                // ROJO: Precio Paralelo o m√°s
                elBadge.classList.add('status-red');
                elBadge.innerText = "ALERTA: TASA PARALELA";
                analisis.innerText = "Te inflaron el precio para cobrarte a paralelo.";
            } else {
                // AMARILLO: Ni chicha ni limonada
                elBadge.classList.add('status-yellow');
                elBadge.innerText = "TASA MIXTA / INFLADA";
                analisis.innerText = "Es m√°s caro que BCV, ten cuidado.";
            }

        } else {
            elImplicita.innerText = "--";
            elBadge.className = 'status-badge';
            elBadge.innerText = "Esperando datos";
            document.getElementById('analisisTexto').innerText = "";
        }
    }

    /* --- 5. LOG DE SNAPSHOTS --- */
    function guardarSnapshot() {
        const base = elBase.value;
        const piden = elPiden.value;
        const moneda = elMoneda.value;
        const tasaImp = elImplicita.innerText;
        const status = elBadge.innerText;
        
        if(!base || !piden) return;

        const time = new Date().toLocaleTimeString('es-VE', {hour:'2-digit', minute:'2-digit'});
        
        const item = document.createElement('div');
        item.className = 'log-item';
        
        // Formato Log
        item.innerHTML = `
            <div style="display:flex; justify-content:space-between; color:white;">
                <span>${time}</span>
                <span class="log-highlight">${tasaImp}</span>
            </div>
            <div>Ref: $${base} | Piden: ${piden} ${moneda.toUpperCase()}</div>
            <div style="font-size:9px; margin-top:2px; color:${status.includes('ALERTA') ? '#e74c3c' : '#2ecc71'}">${status}</div>
        `;

        const container = document.getElementById('logContainer');
        // Quitar mensaje de "vacio" si existe
        if(container.children[0] && container.children[0].innerText.includes('No hay')) {
            container.innerHTML = '';
        }
        container.prepend(item);
    }

    function borrarLog() {
        document.getElementById('logContainer').innerHTML = '<div style="text-align:center; padding:20px; color:#555">No hay registros a√∫n</div>';
    }

    // Inicio
    buscarTasasAPI();

</script>

</body>
</html>
