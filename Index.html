<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Estilos base para simular iOS y inputs limpios */
        body { background-color: #000; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .ios-btn:active { opacity: 0.7; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen bg-black">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Colores configurados
        const COLORS = {
            vinotinto: '#800020',
            iosOrange: '#ff9f0a',
            iosDarkGray: '#333333',
            iosLightGray: '#a5a5a5',
        };

        const App = () => {
            // Estado de la vista: 'calculator' o 'tool'
            const [viewMode, setViewMode] = useState('calculator'); 
            
            // Estado Calculadora
            const [calcDisplay, setCalcDisplay] = useState('0');
            const [waitingForOperand, setWaitingForOperand] = useState(false);
            const [operator, setOperator] = useState(null);
            const [value, setValue] = useState(null);

            // Estado Herramienta
            const [rates, setRates] = useState({
                bcv: 46.20,
                paralelo: 54.50,
                euro: 49.10,
                binance: 55.02,
                promedio: 52.30
            });

            const [inputs, setInputs] = useState({
                priceDollar: '',
                priceBs: '',
                customBcv: '',
                customParalelo: ''
            });

            const [loading, setLoading] = useState(false);

            // DETECTOR DE CÃ“DIGO SECRETO
            useEffect(() => {
                if (calcDisplay === '676767') {
                    setTimeout(() => {
                        setViewMode('tool');
                        setCalcDisplay('0');
                        setValue(null);
                        setOperator(null);
                    }, 300);
                }
            }, [calcDisplay]);

            // --- LÃ“GICA CALCULADORA ---
            const inputDigit = (digit) => {
                if (waitingForOperand) {
                    setCalcDisplay(String(digit));
                    setWaitingForOperand(false);
                } else {
                    setCalcDisplay(calcDisplay === '0' ? String(digit) : calcDisplay + digit);
                }
            };

            const performOperation = (nextOperator) => {
                const inputValue = parseFloat(calcDisplay);
                if (value === null) {
                    setValue(inputValue);
                } else if (operator) {
                    const currentValue = value || 0;
                    const newValue = calculate(currentValue, inputValue, operator);
                    setValue(newValue);
                    setCalcDisplay(String(newValue));
                }
                setWaitingForOperand(true);
                setOperator(nextOperator);
            };

            const calculate = (prev, next, op) => {
                switch (op) {
                    case '+': return prev + next;
                    case '-': return prev - next;
                    case '*': return prev * next;
                    case '/': return prev / next;
                    default: return next;
                }
            };

            const clearCalc = () => {
                setCalcDisplay('0');
                setValue(null);
                setOperator(null);
                setWaitingForOperand(false);
            };

            // --- LÃ“GICA HERRAMIENTA ---
            const handleFetchRates = () => {
                setLoading(true);
                setTimeout(() => {
                    // SimulaciÃ³n de actualizaciÃ³n
                    setRates(prev => ({
                        ...prev,
                        bcv: (prev.bcv + 0.05).toFixed(2) * 1,
                        paralelo: (prev.paralelo + 0.10).toFixed(2) * 1
                    }));
                    setLoading(false);
                }, 800);
            };

            const activeBcv = inputs.customBcv !== '' ? parseFloat(inputs.customBcv) : rates.bcv;
            const activeParalelo = inputs.customParalelo !== '' ? parseFloat(inputs.customParalelo) : rates.paralelo;

            let tasaImplicita = 0;
            if (inputs.priceDollar && inputs.priceBs) {
                tasaImplicita = parseFloat(inputs.priceBs) / parseFloat(inputs.priceDollar);
            }

            // Componente BotÃ³n Calculadora
            const CalcButton = ({ label, type = 'num', onClick, double = false }) => {
                let bg = COLORS.iosDarkGray;
                let text = 'white';
                if (type === 'orange') { bg = COLORS.iosOrange; }
                if (type === 'top') { bg = COLORS.iosLightGray; text = 'black'; }

                return (
                    <button 
                        onClick={onClick}
                        className={`ios-btn ${double ? 'col-span-2' : ''} h-16 w-full rounded-full flex items-center justify-center text-3xl font-medium transition-opacity`}
                        style={{ backgroundColor: bg, color: text }}
                    >
                        {label}
                    </button>
                );
            };

            // --- VISTA CALCULADORA ---
            if (viewMode === 'calculator') {
                return (
                    <div className="flex flex-col items-center justify-end h-[650px] w-[360px] bg-black text-white p-5 rounded-[40px] shadow-2xl border border-gray-800 relative overflow-hidden">
                        
                        {/* Pantalla */}
                        <div className="w-full h-32 flex items-end justify-end px-2 mb-4">
                            <span className="text-7xl font-light tracking-tight truncate">{calcDisplay}</span>
                        </div>

                        {/* Teclado */}
                        <div className="w-full grid grid-cols-4 gap-3">
                            <CalcButton label="AC" type="top" onClick={clearCalc} />
                            <CalcButton label="+/-" type="top" onClick={() => {}} />
                            <CalcButton label="%" type="top" onClick={() => {}} />
                            <CalcButton label="Ã·" type="orange" onClick={() => performOperation('/')} />

                            <CalcButton label="7" onClick={() => inputDigit(7)} />
                            <CalcButton label="8" onClick={() => inputDigit(8)} />
                            <CalcButton label="9" onClick={() => inputDigit(9)} />
                            <CalcButton label="Ã—" type="orange" onClick={() => performOperation('*')} />

                            <CalcButton label="4" onClick={() => inputDigit(4)} />
                            <CalcButton label="5" onClick={() => inputDigit(5)} />
                            <CalcButton label="6" onClick={() => inputDigit(6)} />
                            <CalcButton label="-" type="orange" onClick={() => performOperation('-')} />

                            <CalcButton label="1" onClick={() => inputDigit(1)} />
                            <CalcButton label="2" onClick={() => inputDigit(2)} />
                            <CalcButton label="3" onClick={() => inputDigit(3)} />
                            <CalcButton label="+" type="orange" onClick={() => performOperation('+')} />

                            <CalcButton label="0" double onClick={() => inputDigit(0)} />
                            <CalcButton label="." onClick={() => inputDigit('.')} />
                            <CalcButton label="=" type="orange" onClick={() => performOperation('=')} />
                        </div>
                    </div>
                );
            }

            // --- VISTA HERRAMIENTA ---
            return (
                <div className="flex flex-col h-[650px] w-[360px] bg-[#121212] text-white rounded-[40px] shadow-2xl relative border border-gray-800 p-5 font-sans">
                    
                    {/* BotÃ³n Salir (Camuflaje) */}
                    <button 
                        onClick={() => setViewMode('calculator')}
                        className="absolute top-5 right-5 p-2 rounded-full bg-gray-800 hover:bg-gray-700 text-red-500 z-50 transition-colors"
                    >
                        {/* Icono X SVG */}
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                    </button>

                    {/* Header */}
                    <div className="flex items-center gap-3 mb-1 mt-2">
                        <h1 className="text-2xl font-bold text-red-600 tracking-tight">Calculadolar ðŸ‡»ðŸ‡ª</h1>
                        <button 
                            onClick={handleFetchRates}
                            className={`p-2 bg-gray-800 rounded-full text-gray-300 ${loading ? 'animate-spin' : ''}`}
                        >
                            {/* Icono Refresh SVG */}
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
                        </button>
                    </div>

                    {/* Ticker Referencial */}
                    <div className="flex gap-4 text-sm text-yellow-500/90 mb-8 font-mono overflow-x-auto whitespace-nowrap pb-2 border-b border-gray-800">
                        <span>EUR: {rates.euro}</span> â€¢
                        <span>BIN: {rates.binance}</span> â€¢
                        <span>PROM: {rates.promedio}</span>
                    </div>

                    {/* Cuerpo Principal */}
                    <div className="flex flex-col gap-5">
                        
                        {/* Fila 1: Tasas */}
                        <div className="grid grid-cols-2 gap-4">
                            <div className="flex flex-col gap-1">
                                <label className="text-xs text-green-500 font-semibold ml-1">Tasa BCV</label>
                                <input 
                                    type="number" 
                                    placeholder={rates.bcv}
                                    value={inputs.customBcv}
                                    onChange={(e) => setInputs({...inputs, customBcv: e.target.value})}
                                    className="w-full bg-[#1c1c1e] border border-green-600 text-green-500 p-4 rounded-xl focus:outline-none focus:ring-1 focus:ring-green-500 text-xl font-bold placeholder-green-500/30 text-center"
                                />
                            </div>
                            <div className="flex flex-col gap-1">
                                <label className="text-xs text-red-500 font-semibold ml-1">Tasa Paralelo</label>
                                <input 
                                    type="number" 
                                    placeholder={rates.paralelo}
                                    value={inputs.customParalelo}
                                    onChange={(e) => setInputs({...inputs, customParalelo: e.target.value})}
                                    className="w-full bg-[#1c1c1e] border border-red-600 text-red-500 p-4 rounded-xl focus:outline-none focus:ring-1 focus:ring-red-500 text-xl font-bold placeholder-red-500/30 text-center"
                                />
                            </div>
                        </div>

                        {/* Fila 2: Precios */}
                        <div className="grid grid-cols-2 gap-4">
                            <div className="flex flex-col gap-1">
                                <label className="text-xs text-gray-400 ml-1">Precio Marcado ($)</label>
                                <input 
                                    type="number" 
                                    value={inputs.priceDollar}
                                    onChange={(e) => setInputs({...inputs, priceDollar: e.target.value})}
                                    className="w-full bg-[#2c2c2e] border border-gray-700 text-white p-4 rounded-xl focus:outline-none focus:border-gray-500 text-xl text-center placeholder-gray-600"
                                    placeholder="10"
                                />
                            </div>
                            <div className="flex flex-col gap-1">
                                <label className="text-xs text-gray-400 ml-1">Me piden... (Bs)</label>
                                <input 
                                    type="number" 
                                    value={inputs.priceBs}
                                    onChange={(e) => setInputs({...inputs, priceBs: e.target.value})}
                                    className="w-full bg-[#2c2c2e] border border-gray-700 text-white p-4 rounded-xl focus:outline-none focus:border-gray-500 text-xl text-center placeholder-gray-600"
                                    placeholder="500"
                                />
                            </div>
                        </div>

                        {/* Resultado */}
                        <div className="mt-2 p-5 rounded-2xl border border-dashed border-gray-700 bg-gray-900/50 flex flex-col items-center justify-center">
                            <span className="text-xs text-gray-500 uppercase tracking-wider mb-2">Tasa ImplÃ­cita de Pago</span>
                            {tasaImplicita > 0 ? (
                                <div className="text-center">
                                    <div className="text-4xl font-bold text-white mb-1">{tasaImplicita.toFixed(2)}</div>
                                    <span className="text-sm text-gray-400">BolÃ­vares por DÃ³lar</span>
                                </div>
                            ) : (
                                <span className="text-3xl font-bold text-gray-700">--.--</span>
                            )}
                            
                            {tasaImplicita > 0 && (
                                <div className={`mt-3 text-xs px-3 py-1 rounded-full font-bold uppercase tracking-wide ${
                                    tasaImplicita > activeParalelo ? 'bg-red-900/80 text-red-200' : 
                                    tasaImplicita < activeBcv ? 'bg-green-900/80 text-green-200' : 
                                    'bg-yellow-900/80 text-yellow-200'
                                }`}>
                                    {tasaImplicita > activeParalelo ? 'Sobreprecio' : 
                                     tasaImplicita < activeBcv ? 'Subvaluado' : 'En Rango'}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Footer / BotÃ³n Log */}
                    <div className="mt-auto">
                        <button 
                            className="w-full py-4 rounded-2xl text-white font-bold text-lg shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-2"
                            style={{ backgroundColor: COLORS.vinotinto }}
                        >
                            Guardar en Log
                        </button>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
