<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Calculadolar ðŸ‡»ðŸ‡ª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { background-color: #000; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; user-select: none; overflow: hidden; margin: 0; }
        
        /* Escena 3D - Ajustada para Responsive */
        .scene { perspective: 1000px; width: 100%; max-width: 375px; height: 740px; position: relative; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s cubic-bezier(0.4, 0.0, 0.2, 1); transform-style: preserve-3d; }
        .card-inner.flipped { transform: rotateY(180deg); }
        
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; -webkit-backface-visibility: hidden; border-radius: 40px; overflow: hidden; border: 1px solid #333; background: #000; }
        /* La cara trasera debe estar girada de inicio */
        .card-back { transform: rotateY(180deg); background-color: #121212; display: flex; flex-direction: column; }
        
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .ios-btn:active { transform: scale(0.95); opacity: 0.8; }
        .mini-btn:active { background-color: #555 !important; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .ticker-item { display: inline-flex; align-items: center; gap: 4px; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen bg-black">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Seccion-002: Componente Principal
        const App = () => {
            // Seccion-002.1: DefiniciÃ³n de Estados (Hooks)
            const [isFlipped, setIsFlipped] = useState(false);
            
            // --- ESTADO CALC GRANDE ---
            const [mainDisp, setMainDisp] = useState('0');
            const [mainWait, setMainWait] = useState(false);
            const [mainOp, setMainOp] = useState(null);
            const [mainVal, setMainVal] = useState(null);

            // --- ESTADO MINI CALC ---
            const [miniDisp, setMiniDisp] = useState('0');
            const [miniWait, setMiniWait] = useState(false);
            const [miniOp, setMiniOp] = useState(null);
            const [miniVal, setMiniVal] = useState(null);

            // Datos
            const [loading, setLoading] = useState(false);
            const [rates, setRates] = useState({ bcv: 46.20, paralelo: 54.50, euro: 49.10, binance: 55.00, promedio: 52.30 });
            
            const [inputs, setInputs] = useState({
                priceDollar: '',
                payAmount: '',
                currency: 'Bs', 
                customBcv: '',
                customParalelo: ''
            });

            // Log
            const [log, setLog] = useState([]);
            const [showHistory, setShowHistory] = useState(false);

            // Seccion-003: LÃ³gica de Datos (API)
            // Obtiene tasas de cambio desde APIs externas
            const fetchRates = async () => {
                setLoading(true);
                
                // Paso 1: Limpiar inputs manuales para que se vea el cambio
                setInputs(prev => ({...prev, customBcv: '', customParalelo: ''}));

                try {
                    // Intentamos obtener datos
                    let dataUSD = [], dataEUR = [];
                    try {
                        const r1 = await fetch('https://ve.dolarapi.com/v1/dolares');
                        if(r1.ok) dataUSD = await r1.json();
                    } catch(e){}

                    try {
                        const r2 = await fetch('https://ve.dolarapi.com/v1/euros');
                        if(r2.ok) dataEUR = await r2.json();
                    } catch(e){}

                    // FunciÃ³n auxiliar para extraer valor seguro
                    const getVal = (arr, key, def) => {
                        const item = arr.find(d => d.fuente === key || d.titulo === key);
                        return item && item.promedio ? parseFloat(item.promedio) : def;
                    };

                    setRates({
                        bcv: getVal(dataUSD, 'oficial', 46.20),
                        paralelo: getVal(dataUSD, 'paralelo', 54.50),
                        binance: getVal(dataUSD, 'Binance', 55.00),
                        promedio: getVal(dataUSD, 'Promedio', 52.30),
                        euro: getVal(dataEUR, 'oficial', 49.10)
                    });

                } catch (e) {
                    console.error("Error API", e);
                } finally {
                    setLoading(false);
                }
            };

            // Seccion-004: Efectos Secundarios (Hooks)
            // Carga inicial de datos
            useEffect(() => { fetchRates(); }, []);

            // Seccion-004.1: Camuflaje
            // Activa la vista oculta al detectar cÃ³digo especÃ­fico
            useEffect(() => {
                if (mainDisp === '676767') {
                    setTimeout(() => {
                        setIsFlipped(true);
                        setMainDisp('0'); setMainVal(null); setMainOp(null);
                    }, 200);
                }
            }, [mainDisp]);

            // Seccion-005: LÃ³gica de Negocio (CÃ¡lculos)
            const activeBcv = inputs.customBcv ? parseFloat(inputs.customBcv) : rates.bcv;
            const activePar = inputs.customParalelo ? parseFloat(inputs.customParalelo) : rates.paralelo;
            const basePrice = parseFloat(inputs.priceDollar);
            const payAmount = parseFloat(inputs.payAmount);

            // Seccion-006: Componentes de UI DinÃ¡micos
            // Muestra conversiÃ³n rÃ¡pida de precio base
            const infoBase = basePrice > 0 ? (
                <div className="flex flex-col gap-0.5 mt-1 text-[9px] font-mono text-gray-500">
                    <div className="flex justify-between"><span>Oficial:</span> <span className="text-gray-300 font-bold">Bs {(basePrice * activeBcv).toFixed(2)}</span></div>
                    <div className="flex justify-between"><span>Paralelo:</span> <span className="text-gray-300 font-bold">Bs {(basePrice * activePar).toFixed(2)}</span></div>
                </div>
            ) : <div className="mt-1 text-[9px] text-gray-600 italic">Ingresa precio...</div>;

            // Muestra conversiÃ³n inversa del monto a pagar
            const infoPay = payAmount > 0 ? (
                inputs.currency === 'Bs' ? (
                    <div className="flex flex-col gap-0.5 mt-1 text-[9px] font-mono text-gray-500">
                        <div className="flex justify-between"><span>Si fuera BCV:</span> <span className="text-gray-300 font-bold">${(payAmount / activeBcv).toFixed(2)}</span></div>
                        <div className="flex justify-between"><span>Si fuera Par:</span> <span className="text-gray-300 font-bold">${(payAmount / activePar).toFixed(2)}</span></div>
                    </div>
                ) : (
                    <div className="flex flex-col gap-0.5 mt-1 text-[9px] font-mono text-gray-500">
                        <div className="flex justify-between"><span>A tasa BCV:</span> <span className="text-gray-300 font-bold">Bs {(payAmount * activeBcv).toFixed(2)}</span></div>
                        <div className="flex justify-between"><span>A tasa Par:</span> <span className="text-gray-300 font-bold">Bs {(payAmount * activePar).toFixed(2)}</span></div>
                    </div>
                )
            ) : <div className="mt-1 text-[9px] text-gray-600 italic">Ingresa monto...</div>;

            // Seccion-006.1: SemÃ¡foro de Tasas
            // Determina el color y mensaje segÃºn la tasa implÃ­cita
            let tasaImp = 0;
            let status = { text: 'ESPERANDO', color: 'text-gray-500', bg: 'bg-gray-800' };
            
            if (basePrice > 0 && payAmount > 0) {
                if (inputs.currency === 'Bs') {
                    tasaImp = payAmount / basePrice;
                } else {
                    tasaImp = (payAmount / basePrice) * activeBcv;
                }

                if (tasaImp <= activeBcv * 1.01) status = { text: 'EXCELENTE (OFICIAL)', color: 'text-green-400', bg: 'bg-green-900/30 border border-green-600' };
                else if (tasaImp >= activePar * 0.99) status = { text: 'ALERTA: PARALELO', color: 'text-red-400', bg: 'bg-red-900/30 border border-red-600' };
                else status = { text: 'TASA MIXTA / INFLADA', color: 'text-yellow-400', bg: 'bg-yellow-900/30 border border-yellow-600' };
            }

            // Seccion-007: GestiÃ³n de Historial (Log)
            // Guarda el cÃ¡lculo actual en el estado
            const saveLog = () => {
                if(tasaImp > 0) {
                    setLog([{id: Date.now(), rate: tasaImp.toFixed(2), status: status.text}, ...log]);
                    // AnimaciÃ³n simple del botÃ³n
                    const btn = document.getElementById('logIcon');
                    if(btn) {
                        btn.style.color = '#2ecc71';
                        setTimeout(() => btn.style.color = 'white', 1000);
                    }
                }
            };

            // Seccion-008: NÃºcleo de Calculadoras
            // FunciÃ³n pura para operaciones aritmÃ©ticas
            const doMath = (disp, setDisp, wait, setWait, op, setOp, val, setVal, input) => {
                if(typeof input === 'number' || input === '.') {
                    if(wait) {
                        setDisp(String(input));
                        setWait(false);
                    } else {
                        setDisp(disp === '0' && input !== '.' ? String(input) : disp + input);
                    }
                } else if (['+','-','*','/'].includes(input)) {
                    const curr = parseFloat(disp);
                    if(val === null) {
                        setVal(curr);
                    } else if(op) {
                        const res = op==='+'?val+curr : op==='-'?val-curr : op==='*'?val*curr : val/curr;
                        setVal(res);
                        setDisp(String(res));
                    }
                    setWait(true);
                    setOp(input);
                } else if (input === '=') {
                    if(op && val !== null) {
                        const curr = parseFloat(disp);
                        const res = op==='+'?val+curr : op==='-'?val-curr : op==='*'?val*curr : val/curr;
                        setVal(null);
                        setOp(null);
                        setDisp(String(res));
                        setWait(true);
                    }
                } else if (input === 'AC') {
                    setDisp('0'); setVal(null); setOp(null); setWait(false);
                }
            };

            // Seccion-009: Controladores de Eventos
            // Wrappers para conectar la UI con la lÃ³gica matemÃ¡tica
            const handleMain = (x) => doMath(mainDisp, setMainDisp, mainWait, setMainWait, mainOp, setMainOp, mainVal, setMainVal, x);
            const handleMini = (x) => doMath(miniDisp, setMiniDisp, miniWait, setMiniWait, miniOp, setMiniOp, miniVal, setMiniVal, x);

            // Seccion-010: Renderizado (JSX)
            return (
                <div className="scene">
                    <div className={`card-inner ${isFlipped ? 'flipped' : ''}`}>
                        
                        {/* Seccion-010.1: Vista Frontal (Calculadora Grande) */}
                        <div className="card-face bg-black text-white p-5 flex flex-col justify-end">
                            <div className="flex-1 flex items-end justify-end px-2 mb-6"><span className="text-7xl font-light truncate">{mainDisp}</span></div>
                            <div className="grid grid-cols-4 gap-3 mb-8">
                                {['AC','+/-','%','/','7','8','9','*','4','5','6','-','1','2','3','+'].map(btn => (
                                    <button key={btn} onClick={() => handleMain(btn === 'AC' ? 'AC' : isNaN(btn) ? btn : parseInt(btn))} className={`h-16 rounded-full text-2xl font-medium ios-btn ${['/','*','-','+'].includes(btn) ? 'bg-[#ff9f0a]' : ['AC','+/-','%'].includes(btn) ? 'bg-[#a5a5a5] text-black' : 'bg-[#333]'}`}>
                                        {btn}
                                    </button>
                                ))}
                                <button onClick={() => handleMain(0)} className="col-span-2 h-16 rounded-full bg-[#333] text-2xl font-medium ios-btn pl-6 text-left">0</button>
                                <button onClick={() => handleMain('.')} className="h-16 rounded-full bg-[#333] text-2xl font-medium ios-btn">.</button>
                                <button onClick={() => handleMain('=')} className="h-16 rounded-full bg-[#ff9f0a] text-2xl font-medium ios-btn">=</button>
                            </div>
                        </div>

                        {/* Seccion-010.2: Vista Trasera (Herramienta Pro) */}
                        <div className="card-face card-back text-white font-sans relative">
                            
                            {/* Header y Ticker de Tasas */}
                            <div className="pt-4 px-4 pb-2 bg-[#1a1a1a] border-b border-gray-800">
                                <div className="flex justify-between items-center mb-2">
                                    <div className="flex items-center gap-2">
                                        <h1 className="text-xl font-bold text-red-600">Calculadolar Pro</h1>
                                        <button onClick={fetchRates} className={`p-1.5 bg-gray-800 rounded-full hover:bg-gray-700 text-gray-400 transition-all ${loading ? 'animate-spin text-white' : ''}`}>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></svg>
                                        </button>
                                    </div>
                                    <button onClick={() => setIsFlipped(false)} className="text-gray-500 hover:text-white">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
                                    </button>
                                </div>
                                {/* Ticker */}
                                <div className="flex gap-4 text-[10px] text-yellow-500 font-mono overflow-x-auto whitespace-nowrap scrollbar-hide">
                                    <span className="ticker-item">â‚¬Ofi: {rates.euro.toFixed(2)}</span> â€¢
                                    <span className="ticker-item text-[#F0B90B]">
                                        <svg width="12" height="12" viewBox="0 0 32 32" fill="currentColor"><path d="M16 0l6 6-6 6-6-6 6-6zM6 6l6 6-6 6-6-6 6-6zM26 6l6 6-6 6-6-6 6-6zM16 12l6 6-6 6-6-6 6-6zM6 18l6 6-6 6-6-6 6-6zM26 18l6 6-6 6-6-6 6-6zM16 24l6 6-6 6-6-6 6-6z"/></svg>
                                        BIN: {rates.binance.toFixed(2)}
                                    </span> â€¢
                                    <span className="ticker-item">$Prom: {rates.promedio.toFixed(2)}</span>
                                </div>
                            </div>

                            {/* Seccion-010.3: Contenido Inputs y Resultados */}
                            <div className="flex-1 overflow-y-auto p-4 flex flex-col gap-3">
                                
                                {/* Tasas Personalizables (COLORES CORREGIDOS) */}
                                <div className="grid grid-cols-2 gap-2">
                                    <div>
                                        {/* BCV: Ahora es VERDE */}
                                        <label className="text-[10px] text-green-500 font-bold ml-1">Tasa BCV</label>
                                        <input type="number" placeholder={rates.bcv} value={inputs.customBcv} onChange={e => setInputs({...inputs, customBcv: e.target.value})} className="w-full bg-[#222] border border-green-600 text-green-500 p-2 rounded-lg text-lg font-bold text-center outline-none focus:ring-1 focus:ring-green-500 placeholder-green-500/30" />
                                    </div>
                                    <div>
                                        {/* Paralelo: Ahora es ROJO */}
                                        <label className="text-[10px] text-red-500 font-bold ml-1">Tasa Paralelo</label>
                                        <input type="number" placeholder={rates.paralelo} value={inputs.customParalelo} onChange={e => setInputs({...inputs, customParalelo: e.target.value})} className="w-full bg-[#222] border border-red-600 text-red-500 p-2 rounded-lg text-lg font-bold text-center outline-none focus:ring-1 focus:ring-red-500 placeholder-red-500/30" />
                                    </div>
                                </div>

                                <div className="h-
